machine:
  services:
    - docker

dependencies:
  post:
    - mkdir ~/.docker && echo "{\"https://index.docker.io/v1/\":{\"auth\":\"$DOCKER_AUTH\",\"email\":\"$DOCKER_EMAIL\"}}" >~/.docker/config.json

checkout:
  post:
    - git submodule update --init

deployment:
  release:
    branch: master
    owner: loadimpact
    commands:
      - docker info
      - docker build -t loadimpact/speedboat --rm .
      - docker push loadimpact/speedboat

  develop:
    branch: develop
    owner: loadimpact
    commands:
      - docker info
      - docker build -t loadimpact/speedboat:develop --rm .
      - docker push loadimpact/speedboat:develop
