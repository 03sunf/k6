machine:
  services:
    - docker

checkout:
  post:
    - git submodule update --init

dependencies:
  override:
    - docker info
    - docker build -t loadimpact/speedboat .
    - echo "{\"https://index.docker.io/v1/\":{\"auth\":\"$DOCKER_AUTH\",\"email\":\"$DOCKER_EMAIL\"}}" >~/.dockercfg

test:
  override:
    - docker run --entrypoint /bin/bash loadimpact/speedboat -c 'cd $GOPATH/src/github.com/loadimpact/speedboat && go get -t ./... && go test ./...'

deployment:
  release:
    branch: master
    owner: loadimpact
    commands:
      - docker push loadimpact/speedboat

  develop:
    branch: develop
    owner: loadimpact
    commands:
      - docker tag loadimpact/speedboat loadimpact/speedboat:develop
      - docker push loadimpact/speedboat:develop
